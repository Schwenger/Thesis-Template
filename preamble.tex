%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Fix for deprecated font command
\DeclareOldFontCommand{\sf}{\normalfont\sffamily}{\mathsf}
\DeclareOldFontCommand{\rm}{\normalfont\rmfamily}{\mathsf}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Labels and References

\newcommand{\MarginCrossRef}[1]{%
\marginnote{%
  \scriptsize \MVRightarrow\,%
  \text{\cref{#1}, p.~\pageref{#1}}}%
}

\crefname{definition}{Def.}{Defs.}%
\crefname{section}{Sect.}{Sect.}%
\crefname{examplex}{Exm.}{Exms.}%
\crefname{equation}{Eq.}{Eqs.}%
\crefname{proposition}{Prop.}{Props.}%
\crefname{lemma}{Lem.}{Lems.}%
\crefname{corollary}{Cor.}{Cors.}%
\crefname{theorem}{Thm.}{Thms.}%
\crefname{remark}{Rem.}{Rems.}%
\crefname{figure}{Fig.}{Figs.}%
\crefname{table}{Tbl.}{Tbls.}%
\crefname{algorithm}{Alg.}{Algs.}%

\Crefname{examplex}{Example}{Examples}%

\renewcommand*{\raggedleftmarginnote}{} % Fix spacing in margin notes.

\newcommand{\CCref}[1]{\intextcrossrefmarker{}\Cref{#1}\MarginCrossRef{#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Theorem Environments

\newcommand*\Vhrulefill[1]{\leavevmode\leaders\hrule height 1ex depth \dimexpr#1-1ex\hfill}
\newcommand*{\defheaderline}{{\color{lightgray}\Vhrulefill{1pt}}\par}

\declaretheoremstyle[
  headfont=\bfseries,
  numbered=yes, % DONT change, will break everything for some reason.
  bodyfont=\normalfont,
  spaceabove=\topsep,
  postheadspace=1em,
  headpunct={},
  postheadhook=\defheaderline,
  postfoothook=\noindent\defheaderline\vspace{.5\topsep},
  spacebelow=0pt,  
]{sepdef}

\declaretheorem[
  style=sepdef,
  title=Definition,
  refname={definition,definitions},
  Refname={Definition,Definitions}
]{definition}

\theoremstyle{plain}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{corollary}[theorem]{Corollary}

%\theoremstyle{remark}
\newtheorem{remark}{Remark}[section]

\theoremstyle{definition}
\newtheorem{construction}{Construction}[chapter]
% Taken from https://tex.stackexchange.com/a/32394
\newtheorem{examplex}{Example}[section]
\newenvironment{example}
  {\pushQED{\qed}\renewcommand{\qedsymbol}{\(\triangle\)}\examplex}
  {\popQED\endexamplex}

\NewDocumentCommand{\introterm}{ s o m }{%
  \marginnote{\scriptsize\flushleft%
    \IfBooleanTF{#1}{}{\textbf{Def.}} % Add Def. only if star is not there.
    \IfValueTF{#2}{#2}{#3}% Take optional 2nd arg if it exists, otherwise 3rd.
  }%
  \emph{#3}%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Let figures and tables share counter

\makeatletter
\let\c@table\c@figure{}
\makeatother 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Other Environments

\newcommand{\contribution}[1]{#1}
\newenvironment{decisionproblem}{\begin{quote}``\!\!}{\!\!''\end{quote}}
\newenvironment{invariant}{\begin{quotation}}{\end{quotation}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Ugly hack to get useful \vdots, taken from http://tex.stackexchange.com/a/112212

\makeatletter
\DeclareRobustCommand{\rvdots}{%
  \vbox{
    \baselineskip4\p@\lineskiplimit\z@
    \kern-\p@
    \hbox{.}\hbox{.}\hbox{.}
  }}
\makeatother


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Checkmarks

\newcommand{\cmark}{{\color{mydarkgreen}{\ding{51}}}}%
\newcommand{\ucmark}{{\color{gray}{\raisebox{-1pt}{\ding{55}}}}}%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Complexity Classes

\newcommand{\logspace}{\textsc{LogSpace}\xspace}
\newcommand{\ptime}{\textsc{PTime}\xspace}
\newcommand{\up}{\textsc{UP}\xspace}
\newcommand{\coup}{\textsc{coUP}\xspace}
\newcommand{\np}{\textsc{NP}\xspace}
\newcommand{\conp}{\textsc{coNP}\xspace}
\newcommand{\aptime}{\textsc{APTime}\xspace}
\newcommand{\pspace}{\textsc{PSpace}\xspace}
\newcommand{\exptime}{\textsc{ExpTime}\xspace}
\newcommand{\expspace}{\textsc{ExpSpace}\xspace}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Common text abbreviations
\newcommand*{\eg}{e.g.\@\xspace}
\newcommand*{\ie}{i.e.\@\xspace}
\newcommand*{\st}{s.t.\@\xspace}
\newcommand*{\wrt}{w.r.t.\@\xspace}
\newcommand*{\wolog}{w.l.o.g.\@\xspace} % wlog writes to log.
\newcommand*{\Wlog}{W.l.o.g.\@\xspace}
\makeatletter
\newcommand*{\etc}{%
    \@ifnextchar{.}%
        {etc}%
        {etc.\@\xspace}%
}
\newcommand*{\cf}{%
    \@ifnextchar{.}%
        {cf}%
        {cf.\@\xspace}%
}
\newcommand*{\etal}{%
    \@ifnextchar{.}%
        {et~al}%
        {et~al.\@\xspace}%
}
\makeatother


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Common math macros
\DeclareMathOperator{\bigO}{\mathcal{O}}
\DeclarePairedDelimiter\ceil{\lceil}{\rceil}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}
\newcommand\disjointunion{\mathop{\dot\cup}}
\DeclareMathOperator{\lcm}{lcm}
\DeclareMathOperator{\Variance}{Var}
\DeclareMathOperator{\Covariance}{Cov}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Math formatting and renames
\newcommand*{\definedas}{\coloneqq}
\newcommand*{\set}[1]{\{{#1}\}}
\newcommand*\cardinality[1]{|{#1}|}
\newcommand*{\given}{\mid}
\newcommand*{\from}{\colon}
\newcommand*{\divides}{\bigm|}
\newcommand*{\notdivides}{\nmid}
\newcommand*{\meet}{\sqcap}
\newcommand*\indicator[1]{\mathds{1}_{#1}}
\NewDocumentCommand{\twopartdef}{ m m m o}{
  \left\{
    \begin{array}{ll}
      #1 & \mbox{if } #2 \\
      #3 & \IfNoValueTF{#4}{\text{otherwise}}{\mbox{if } #4}
    \end{array}
  \right.
}
\NewDocumentCommand{\threepartdef}{m m m m m o}{
  \left\{
    \begin{array}{lll}
    #1 & \mbox{if } #2 \\
      #3 & \mbox{if } #4 \\
      #5 & \IfNoValueTF{#6}{\text{otherwise}}{\mbox{if } #6}
    \end{array}
  \right.
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Misc
\newcommand{\globaltodo}[1]{%
  \addcontentsline{tdo}{todo}{#1}%
}
\newcommand*\todoexample{\todo[inline,color=green!30]{Insert Example}}
\NewDocumentCommand{\todocite}{o}{\IfNoValueTF{#1}{Cite}{Cite: #1}}