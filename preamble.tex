%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Fix for deprecated font command
\DeclareOldFontCommand{\sf}{\normalfont\sffamily}{\mathsf}
\DeclareOldFontCommand{\rm}{\normalfont\rmfamily}{\mathsf}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Labels and References

% CrossRef and SecCrossRef are not to be used in the main document, but are only used for the concise definition of the following commands
\newcommand{\CrossRef}[1]{%
\marginnote{%
  \scriptsize \MVRightarrow\,%
  \text{Sec.~\sectionref{#1}, Page~\pageref{#1}}}%
}
\newcommand{\SecCrossRef}[1]{%
\marginnote{%
  \scriptsize \MVRightarrow\,%
  \text{Sec.~\sectionref{#1}, Page~\pageref{#1}}}%
}

\renewcommand*{\raggedleftmarginnote}{} % Fix spacing in margin notes.

\newcommand{\seclabel}[1]{\label{sec:#1}}
\newcommand{\secref}[1]{Sec\-tion~\ref{sec:#1}}
\newcommand{\Csecref}[1]{\intextcrossrefmarker Sec\-tion~\ref{sec:#1}\SecCrossRef{sec:#1}}
\newcommand{\chapref}[1]{Chap\-ter~\ref{sec:#1}}
\newcommand{\Cchapref}[1]{\intextcrossrefmarker Chap\-ter~\ref{sec:#1}\SecCrossRef{sec:#1}}

\newcommand{\equlabel}[1]{\label{eq:#1}}
\newcommand{\equref}[1]{Equa\-tion~\ref{eq:#1}}
\newcommand{\Cequref}[1]{\intextcrossrefmarker Equa\-tion~\ref{eq:#1}\SecCrossRef{eq:#1}}

\newcommand{\proplabel}[1]{\label{prop:#1}}
\newcommand{\propref}[1]{Pro\-po\-si\-tion~\ref{prop:#1}}
\newcommand{\subpropref}[2]{Pro\-po\-si\-tion~\ref{prop:#1}.\ref{prop:#1:#2}}
\newcommand{\Cpropref}[1]{\intextcrossrefmarker  Pro\-po\-si\-tion~\ref{prop:#1}\CrossRef{prop:#1}}
\newcommand{\Csubpropref}[2]{\intextcrossrefmarker Pro\-po\-si\-tion~\ref{prop:#1}.\ref{prop:#1:#2}\CrossRef{prop:#1:#2}}

\newcommand{\lemlabel}[1]{\label{lem:#1}}
\newcommand{\lemref}[1]{Lemma~\ref{lem:#1}}
\newcommand{\sublemref}[2]{Lemma~\ref{lem:#1}.\ref{lem:#1:#2}}
\newcommand{\Clemref}[1]{\intextcrossrefmarker Lemma~\ref{lem:#1}\CrossRef{lem:#1}}
\newcommand{\Csublemref}[2]{\intextcrossrefmarker Lemma~\ref{lem:#1}.\ref{lem:#1:#2}\CrossRef{lem:#1:#2}}

\newcommand{\corlabel}[1]{\label{cor:#1}}
\newcommand{\corref}[1]{Corol\-lary~\ref{cor:#1}}
\newcommand{\subcorref}[2]{Corol\-lary~\ref{cor:#1}.\ref{cor:#1:#2}}
\newcommand{\Ccorref}[1]{\intextcrossrefmarker Corol\-lary~\ref{cor:#1}\CrossRef{cor:#1}}
\newcommand{\Csubcorref}[2]{\intextcrossrefmarker Corol\-lary~\ref{cor:#1}.\ref{cor:#1:#2}\CrossRef{cor:#1}}

\newcommand{\thmlabel}[1]{\label{thm:#1}}
\newcommand{\thmref}[1]{Theorem~\ref{thm:#1}}
\newcommand{\subthmref}[2]{Theorem~\ref{thm:#1}.\ref{thm:#1:#2}}
\newcommand{\Cthmref}[1]{\intextcrossrefmarker Theorem~\ref{thm:#1}\CrossRef{thm:#1}}
\newcommand{\cthmref}[1]{\intextcrossrefmarker Thm~\ref{thm:#1}\CrossRef{thm:#1}}
\newcommand{\Csubthmref}[2]{\intextcrossrefmarker Theorem~\ref{thm:#1}.\ref{thm:#1:#2}\CrossRef{thm:#1:#2}}

\newcommand{\remlabel}[1]{\label{rem:#1}}
\newcommand{\remref}[1]{Remark~\ref{rem:#1}}
\newcommand{\subremref}[2]{Remark~\ref{rem:#1}.\ref{rem:#1:#2}}
\newcommand{\Cremref}[1]{\intextcrossrefmarker Remark~\ref{rem:#1}\SecCrossRef{rem:#1}}
\newcommand{\Csubremref}[2]{\intextcrossrefmarker Remark~\ref{rem:#1}.\ref{rem:#1:#2}\CrossRef{rem:#1:#2}}

\newcommand{\exmlabel}[1]{\label{exm:#1}}
\newcommand{\exmref}[1]{Example~\ref{exm:#1}}
\newcommand{\Cexmref}[1]{\intextcrossrefmarker Example~\ref{exm:#1}\SecCrossRef{exm:#1}}

\newcommand{\figlabel}[1]{\label{fig:#1}}
\newcommand{\figref}[1]{Figure~\ref{fig:#1}}
\newcommand{\subfigref}[2]{Figure~\ref{fig:#1:#2}}
\newcommand{\Cfigref}[1]{\intextcrossrefmarker Figure~\ref{fig:#1}\SecCrossRef{fig:#1}}
\newcommand{\Csubfigref}[2]{\intextcrossrefmarker Figure~\ref{fig:#1:#2}\SecCrossRef{fig:#1:#2}}

\newcommand{\tablabel}[1]{\label{tab:#1}}
\newcommand{\tabref}[1]{Table~\ref{tab:#1}}
\newcommand{\Ctabref}[1]{\intextcrossrefmarker Table~\ref{tab:#1}\SecCrossRef{tab:#1}}

\newcommand{\alglabel}[1]{\label{alg:#1}}
\newcommand{\algref}[1]{Algorithm~\ref{alg:#1}}
\newcommand{\Calgref}[1]{\intextcrossrefmarker Algorithm~\ref{alg:#1}\SecCrossRef{alg:#1}}

\newcommand{\deflabel}[1]{\label{def:#1}}
\newcommand{\defref}[1]{Definition~\ref{def:#1}}
\newcommand{\Cdefref}[1]{\intextcrossrefmarker Def\-i\-ni\-tion~\ref{def:#1}\SecCrossRef{def:#1}}
\newcommand{\cdefref}[1]{\intextcrossrefmarker Def~\ref{def:#1}\SecCrossRef{def:#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Theorem Environments

\newcommand*\Vhrulefill[1]{\leavevmode\leaders\hrule height 1ex depth \dimexpr#1-1ex\hfill}
\newcommand*{\defheaderline}{{\color{lightgray}\Vhrulefill{1pt}}\par}

\declaretheoremstyle[
  headfont=\bfseries,
  numbered=yes, % DONT change, will break everything for some reason.
  bodyfont=\normalfont,
  spaceabove=\topsep,
  postheadspace=1em,
  headpunct={},
  postheadhook=\defheaderline,
  postfoothook=\noindent\defheaderline\vspace{.5\topsep},
  spacebelow=0pt,  
]{sepdef}

\declaretheorem[
  style=sepdef,
  title=Definition,
  refname={definition,definitions},
  Refname={Definition,Definitions}
]{definition}

\theoremstyle{plain}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{corollary}[theorem]{Corollary}

%\theoremstyle{remark}
\newtheorem{remark}{Remark}[section]

\theoremstyle{definition}
\newtheorem{construction}{Construction}[chapter]
% Taken from https://tex.stackexchange.com/a/32394
\newtheorem{examplex}{Example}[section]
\newenvironment{example}
  {\pushQED{\qed}\renewcommand{\qedsymbol}{$\triangle$}\examplex}
  {\popQED\endexamplex}

\NewDocumentCommand{\introterm}{ s o m }{%
  \marginpar{\scriptsize\flushleft%
    \IfBooleanTF{#1}{}{\textbf{Def. }} % Add Def. only if star is not there.
    \IfValueTF{#2}{#2}{#3} % Take optional 2nd arg if it exists, otherwise 3rd.
  }%
  \emph{#3}%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Let figures and tables share counter

\makeatletter
\let\c@table\c@figure
\makeatother 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Other Environments

\newcommand{\contribution}[1]{#1}
\newenvironment{decisionproblem}{\begin{quote}``\!\!}{\!\!''\end{quote}}
\newenvironment{invariant}{\begin{quotation}}{\end{quotation}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Ugly hack to get useful \vdots, taken from http://tex.stackexchange.com/a/112212

\makeatletter
\DeclareRobustCommand{\rvdots}{%
  \vbox{
    \baselineskip4\p@\lineskiplimit\z@
    \kern-\p@
    \hbox{.}\hbox{.}\hbox{.}
  }}
\makeatother


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Checkmarks

\newcommand{\cmark}{{\color{mydarkgreen}{\ding{51}}}}%
\newcommand{\ucmark}{{\color{gray}{\raisebox{-1pt}{\ding{55}}}}}%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Complexity Classes

\newcommand{\logspace}{\textsc{LogSpace}\xspace}
\newcommand{\ptime}{\textsc{PTime}\xspace}
\newcommand{\up}{\textsc{UP}\xspace}
\newcommand{\coup}{\textsc{coUP}\xspace}
\newcommand{\np}{\textsc{NP}\xspace}
\newcommand{\conp}{\textsc{coNP}\xspace}
\newcommand{\aptime}{\textsc{APTime}\xspace}
\newcommand{\pspace}{\textsc{PSpace}\xspace}
\newcommand{\exptime}{\textsc{ExpTime}\xspace}
\newcommand{\expspace}{\textsc{ExpSpace}\xspace}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Common text abbreviations
\newcommand*{\eg}{e.g.\@\xspace}
\newcommand*{\ie}{i.e.\@\xspace}
\newcommand*{\st}{s.t.\@\xspace}
\newcommand*{\wrt}{w.r.t.\@\xspace}
\newcommand*{\wolog}{w.l.o.g.\@\xspace} % wlog writes to log.
\newcommand*{\Wlog}{W.l.o.g.\@\xspace}
\makeatletter
\newcommand*{\etc}{%
    \@ifnextchar{.}%
        {etc}%
        {etc.\@\xspace}%
}
\newcommand*{\cf}{%
    \@ifnextchar{.}%
        {cf}%
        {cf.\@\xspace}%
}
\newcommand*{\etal}{%
    \@ifnextchar{.}%
        {et~al}%
        {et~al.\@\xspace}%
}
\makeatother


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Common math macros
\DeclareMathOperator{\bigO}{\mathcal{O}}
\DeclarePairedDelimiter\ceil{\lceil}{\rceil}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}
\newcommand\disjointunion{\mathop{\dot\cup}}
\DeclareMathOperator{\lcm}{lcm}
\DeclareMathOperator{\Variance}{Var}
\DeclareMathOperator{\Covariance}{Cov}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Math formatting and renames
\newcommand*{\definedas}{\coloneqq}
\newcommand*{\set}[1]{\{{#1}\}}
\newcommand*\cardinality[1]{|{#1}|}
\newcommand*{\given}{\mid}
\newcommand*{\from}{\colon}
\newcommand*{\divides}{\bigm|}
\newcommand*{\notdivides}{\nmid}
\newcommand*{\meet}{\sqcap}
\newcommand*\indicator[1]{\mathds{1}_{#1}}
\NewDocumentCommand{\twopartdef}{ m m m o}{
  \left\{
    \begin{array}{ll}
      #1 & \mbox{if } #2 \\
      #3 & \IfNoValueTF{#4}{\text{otherwise}}{\mbox{if } #4}
    \end{array}
  \right.
}
\NewDocumentCommand{\threepartdef}{m m m m m o}{
  \left\{
    \begin{array}{lll}
    #1 & \mbox{if } #2 \\
      #3 & \mbox{if } #4 \\
      #5 & \IfNoValueTF{#6}{\text{otherwise}}{\mbox{if } #6}
    \end{array}
  \right.
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Misc
\newcommand{\globaltodo}[1]{%
  \addcontentsline{tdo}{todo}{#1}%
}
\newcommand*\todoexample{\todo[inline,color=green!30]{Insert Example}}
\newcommand*\finalizetodo[1]{\todo[color=gray!40]{\scriptsize Finalize: #1}}